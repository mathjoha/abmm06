---
title: "Interaktiv visualisering"
subtitle: "Utforska datatyper och beskrivande statistik"
citation:
  type: document
  title: "Datatyper - Interaktiv visualisering"
  container-title: "ABMM06: Kvantitativa metoder"
  publisher: Lunds universitet
  license: "CC-BY-NC 4.0"
  url: https://mathjoha.github.io/abmm06/dashboards/datatyper-viz.html
format:
  html:
    page-layout: full
    toc: true
---

## Datatyper och statistik

Använd de interaktiva visualiseringarna nedan för att utforska olika datatyper och beräkna beskrivande statistik.

```{ojs}
//| echo: false

// Sample data for different data types
viewof dataType = Inputs.select(
  ["Nominal", "Ordinal", "Intervall", "Kvot"],
  {label: "Välj datatyp:", value: "Ordinal"}
)
```

```{ojs}
//| echo: false

// Generate sample data based on type
sampleData = {
  if (dataType === "Nominal") {
    return [
      {category: "Lund", count: 45},
      {category: "Malmö", count: 38},
      {category: "Helsingborg", count: 22},
      {category: "Annat", count: 15}
    ];
  } else if (dataType === "Ordinal") {
    return [
      {category: "Mycket missnöjd", count: 5, order: 1},
      {category: "Missnöjd", count: 12, order: 2},
      {category: "Neutral", count: 18, order: 3},
      {category: "Nöjd", count: 35, order: 4},
      {category: "Mycket nöjd", count: 30, order: 5}
    ];
  } else if (dataType === "Intervall") {
    return d3.range(100).map(() => ({value: d3.randomNormal(20, 5)()}));
  } else {
    return d3.range(100).map(() => ({value: Math.abs(d3.randomNormal(35, 10)())}));
  }
}
```

```{ojs}
//| echo: false

// Visualization
{
  const width = 600;
  const height = 400;
  const margin = {top: 20, right: 20, bottom: 60, left: 60};

  const svg = d3.create("svg")
    .attr("width", width)
    .attr("height", height)
    .attr("viewBox", [0, 0, width, height]);

  if (dataType === "Nominal" || dataType === "Ordinal") {
    // Bar chart for categorical data
    const data = dataType === "Ordinal"
      ? sampleData.sort((a, b) => a.order - b.order)
      : sampleData;

    const x = d3.scaleBand()
      .domain(data.map(d => d.category))
      .range([margin.left, width - margin.right])
      .padding(0.1);

    const y = d3.scaleLinear()
      .domain([0, d3.max(data, d => d.count)])
      .nice()
      .range([height - margin.bottom, margin.top]);

    svg.append("g")
      .attr("fill", "steelblue")
      .selectAll("rect")
      .data(data)
      .join("rect")
      .attr("x", d => x(d.category))
      .attr("y", d => y(d.count))
      .attr("height", d => y(0) - y(d.count))
      .attr("width", x.bandwidth());

    svg.append("g")
      .attr("transform", `translate(0,${height - margin.bottom})`)
      .call(d3.axisBottom(x))
      .selectAll("text")
      .attr("transform", "rotate(-45)")
      .style("text-anchor", "end");

    svg.append("g")
      .attr("transform", `translate(${margin.left},0)`)
      .call(d3.axisLeft(y));

    svg.append("text")
      .attr("x", width / 2)
      .attr("y", height - 5)
      .attr("text-anchor", "middle")
      .text("Kategori");

    svg.append("text")
      .attr("transform", "rotate(-90)")
      .attr("x", -height / 2)
      .attr("y", 15)
      .attr("text-anchor", "middle")
      .text("Antal");

  } else {
    // Histogram for numerical data
    const values = sampleData.map(d => d.value);

    const x = d3.scaleLinear()
      .domain(d3.extent(values))
      .nice()
      .range([margin.left, width - margin.right]);

    const bins = d3.bin()
      .domain(x.domain())
      .thresholds(x.ticks(20))(values);

    const y = d3.scaleLinear()
      .domain([0, d3.max(bins, d => d.length)])
      .nice()
      .range([height - margin.bottom, margin.top]);

    svg.append("g")
      .attr("fill", "steelblue")
      .selectAll("rect")
      .data(bins)
      .join("rect")
      .attr("x", d => x(d.x0) + 1)
      .attr("width", d => Math.max(0, x(d.x1) - x(d.x0) - 1))
      .attr("y", d => y(d.length))
      .attr("height", d => y(0) - y(d.length));

    svg.append("g")
      .attr("transform", `translate(0,${height - margin.bottom})`)
      .call(d3.axisBottom(x));

    svg.append("g")
      .attr("transform", `translate(${margin.left},0)`)
      .call(d3.axisLeft(y));

    svg.append("text")
      .attr("x", width / 2)
      .attr("y", height - 5)
      .attr("text-anchor", "middle")
      .text("Värde");

    svg.append("text")
      .attr("transform", "rotate(-90)")
      .attr("x", -height / 2)
      .attr("y", 15)
      .attr("text-anchor", "middle")
      .text("Frekvens");
  }

  return svg.node();
}
```

```{ojs}
//| echo: false

// Statistics display
{
  if (dataType === "Nominal") {
    const total = d3.sum(sampleData, d => d.count);
    const mode = sampleData.reduce((a, b) => a.count > b.count ? a : b);
    return md`
**Tillåten statistik för nominal data:**
- Totalt antal: ${total}
- Typvärde (mode): ${mode.category} (${mode.count} st, ${(mode.count/total*100).toFixed(1)}%)
    `;
  } else if (dataType === "Ordinal") {
    const total = d3.sum(sampleData, d => d.count);
    const sorted = sampleData.sort((a, b) => a.order - b.order);
    let cumSum = 0;
    let median = "";
    for (const d of sorted) {
      cumSum += d.count;
      if (cumSum >= total / 2 && !median) {
        median = d.category;
      }
    }
    return md`
**Tillåten statistik för ordinal data:**
- Totalt antal: ${total}
- Median: ${median}
- Typvärde: ${sampleData.reduce((a, b) => a.count > b.count ? a : b).category}
    `;
  } else {
    const values = sampleData.map(d => d.value);
    const mean = d3.mean(values);
    const median = d3.median(values);
    const std = d3.deviation(values);
    const q1 = d3.quantile(values.sort((a, b) => a - b), 0.25);
    const q3 = d3.quantile(values.sort((a, b) => a - b), 0.75);

    return md`
**Beskrivande statistik för ${dataType.toLowerCase()} data:**
- Antal observationer: ${values.length}
- Medelvärde (mean): ${mean.toFixed(2)}
- Standardavvikelse (std): ${std.toFixed(2)}
- Median: ${median.toFixed(2)}
- Q1 (25:e percentilen): ${q1.toFixed(2)}
- Q3 (75:e percentilen): ${q3.toFixed(2)}
- IQR: ${(q3 - q1).toFixed(2)}
    `;
  }
}
```

## Prova själv

Välj olika datatyper i menyn ovan för att se hur visualiseringar och tillåtna statistiska mått förändras. Lägg märke till att:

- **Nominal data** endast tillåter frekvensräkning och typvärde
- **Ordinal data** tillåter även median och percentiler
- **Intervall- och kvotdata** tillåter alla statistiska mått inklusive medelvärde och standardavvikelse
